<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>Enouvo Map</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <!-- Load Leaflet -->
  <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="../dist/leaflet-trains.css" />
  <script src="../node_modules/leaflet/dist/leaflet-src.js"></script>

  <!-- Load Esri Leaflet from source-->
  <script src="../dist/leaflet-trains-debug.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      right: 0;
      left: 0;
    }

    #info-pane {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      padding: 1em;
      background: white;
    }
  </style>
</head>

<body>

  <div id="map"></div>
  <script>
    var collections = [{
      "properties": {
        "Name": "Glen Waverley Line",
        "name": "Glen Waverley Line",
        "Id": "DjFAIvCY"
      },
      "paths": [
        [145.00725, -37.82754],
        [145.01027, -37.82787],
        [145.01127, -37.82795],
        [145.01231, -37.82789],
        [145.01397, -37.82773],
        [145.0153, -37.8277],
        [145.01728, -37.82777],
        [145.01802, -37.82793],
        [145.01853, -37.82809],
        [145.01905, -37.8283],
        [145.01942, -37.82857],
        [145.01965, -37.82886],
        [145.02, -37.82933],
        [145.02034, -37.82996],
        [145.02064, -37.83069],
        [145.02088, -37.8314],
        [145.02157, -37.83315],
        [145.02187, -37.83357],
        [145.02223, -37.83418],
        [145.0226, -37.83462],
        [145.02335, -37.83523],
        [145.02375, -37.83564],
        [145.02425, -37.83606],
        [145.02487, -37.83694],
        [145.02523, -37.83738],
        [145.02573, -37.83806],
        [145.02639, -37.83855],
        [145.02699, -37.83891],
        [145.02796, -37.83925],
        [145.02912, -37.83942],
        [145.03094, -37.83957],
        [145.03315, -37.83984],
        [145.03407, -37.84011],
        [145.03558, -37.84075],
        [145.03661, -37.84155],
        [145.03701, -37.84198],
        [145.03729, -37.84242],
        [145.03787, -37.84348],
        [145.03828, -37.84411],
        [145.03929, -37.84608],
        [145.03993, -37.84728],
        [145.04122, -37.84892],
        [145.04225, -37.84975],
        [145.04457, -37.85089],
        [145.04684, -37.85165],
        [145.04766, -37.85199],
        [145.04897, -37.85241],
        [145.05023, -37.8528],
        [145.053, -37.85378],
        [145.05362, -37.85409],
        [145.0542, -37.85445],
        [145.05465, -37.85483],
        [145.05635, -37.85688],
        [145.05706, -37.85787],
        [145.05768, -37.85863],
        [145.05845, -37.8598],
        [145.05955, -37.86207],
        [145.05976, -37.86271],
        [145.06057, -37.86537],
        [145.06096, -37.86644],
        [145.06214, -37.86808],
        [145.06326, -37.86932],
        [145.06407, -37.87034],
        [145.06442, -37.87096],
        [145.06538, -37.87313],
        [145.06564, -37.87386],
        [145.06605, -37.8745],
        [145.06641, -37.87498],
        [145.06675, -37.87535],
        [145.06729, -37.87578],
        [145.0679, -37.87622],
        [145.06843, -37.87654],
        [145.06952, -37.87701],
        [145.07015, -37.87722],
        [145.07072, -37.87738],
        [145.07139, -37.87749],
        [145.07204, -37.87751],
        [145.07252, -37.87748],
        [145.07494, -37.87727],
        [145.07752, -37.87713],
        [145.07845, -37.87706],
        [145.08112, -37.87677],
        [145.08455, -37.87596],
        [145.08979, -37.87465],
        [145.09264, -37.87421],
        [145.09675, -37.87385],
        [145.10858, -37.87302],
        [145.10919, -37.87303],
        [145.10956, -37.87305],
        [145.11042, -37.87319],
        [145.11187, -37.87353],
        [145.1123, -37.8737],
        [145.1143, -37.87437],
        [145.11508, -37.8746],
        [145.11584, -37.87478],
        [145.11727, -37.87498],
        [145.12017, -37.87521],
        [145.12447, -37.8753],
        [145.14041, -37.87523],
        [145.14763, -37.87612],
        [145.15234, -37.87675],
        [145.1627, -37.87962]
      ]
    }, {
      "properties": {
        "Name": "Hurstbridge Line",
        "name": "Hurstbridge Line",
        "Id": "J3T9u1H4"
      },
      "paths": [
        [144.99576, -37.78653],
        [144.9961, -37.78583],
        [144.99748, -37.78359],
        [144.99847, -37.78185],
        [144.99907, -37.7809],
        [144.99981, -37.78008],
        [145.00045, -37.77968],
        [145.00121, -37.77938],
        [145.00251, -37.77921],
        [145.00387, -37.77917],
        [145.01682, -37.77919],
        [145.02422, -37.77917],
        [145.02687, -37.77915],
        [145.0285, -37.77908],
        [145.02944, -37.77895],
        [145.03146, -37.77835],
        [145.03626, -37.77677],
        [145.03682, -37.7765],
        [145.03762, -37.77598],
        [145.03837, -37.77513],
        [145.04253, -37.7703],
        [145.04328, -37.7698],
        [145.04412, -37.7694],
        [145.04789, -37.76797],
        [145.04987, -37.7665],
        [145.05201, -37.76507],
        [145.05294, -37.76436],
        [145.05459, -37.76314],
        [145.05549, -37.76225],
        [145.05618, -37.76139],
        [145.05712, -37.76025],
        [145.05779, -37.75959],
        [145.05987, -37.75791],
        [145.06182, -37.75645],
        [145.06324, -37.75533],
        [145.06497, -37.75401],
        [145.0657, -37.75337],
        [145.06605, -37.75282],
        [145.06639, -37.75204],
        [145.06658, -37.75114],
        [145.06667, -37.7499],
        [145.06693, -37.74722],
        [145.06697, -37.74632],
        [145.06628, -37.74361],
        [145.06579, -37.7413],
        [145.06545, -37.73801],
        [145.06551, -37.73682],
        [145.06568, -37.73584],
        [145.06742, -37.73192],
        [145.06817, -37.73005],
        [145.06886, -37.72801],
        [145.06897, -37.72659],
        [145.06912, -37.72574],
        [145.06935, -37.7246],
        [145.06952, -37.7236],
        [145.06997, -37.72248],
        [145.07051, -37.72172],
        [145.07113, -37.72101],
        [145.0721, -37.72041],
        [145.07392, -37.71953],
        [145.07579, -37.71853],
        [145.07669, -37.71778],
        [145.07723, -37.71717],
        [145.07828, -37.71588],
        [145.07881, -37.71527],
        [145.07942, -37.71481],
        [145.08051, -37.7142],
        [145.08148, -37.71333],
        [145.0821, -37.71281],
        [145.08517, -37.7096],
        [145.08856, -37.70671],
        [145.08907, -37.70607],
        [145.09066, -37.70359],
        [145.09162, -37.7023],
        [145.09401, -37.70009],
        [145.09478, -37.69957],
        [145.09547, -37.69919],
        [145.09609, -37.69904],
        [145.09699, -37.69889],
        [145.09789, -37.69897],
        [145.09881, -37.69921],
        [145.09963, -37.6996],
        [145.10175, -37.70016],
        [145.10222, -37.70038],
        [145.103, -37.7008],
        [145.10379, -37.70135],
        [145.10456, -37.70182],
        [145.10525, -37.70215],
        [145.10581, -37.70237],
        [145.10643, -37.70265],
        [145.10722, -37.70316],
        [145.10763, -37.70354],
        [145.10847, -37.7044],
        [145.10892, -37.70498],
        [145.10926, -37.70547],
        [145.10984, -37.70622],
        [145.11027, -37.70683],
        [145.11094, -37.70736],
        [145.11182, -37.70824],
        [145.11257, -37.70889],
        [145.11323, -37.70963],
        [145.11493, -37.71181],
        [145.11647, -37.71362],
        [145.11679, -37.71396],
        [145.11722, -37.71425],
        [145.1177, -37.7145],
        [145.11823, -37.71474],
        [145.11898, -37.71496],
        [145.1204, -37.7151],
        [145.12119, -37.71525],
        [145.12203, -37.71545],
        [145.12521, -37.71646],
        [145.12596, -37.71664],
        [145.12679, -37.71681],
        [145.12769, -37.71685],
        [145.1295, -37.71669],
        [145.13029, -37.71642],
        [145.13124, -37.71617],
        [145.13411, -37.71472],
        [145.1351, -37.71456],
        [145.136, -37.71459],
        [145.13681, -37.71476],
        [145.13752, -37.71513],
        [145.13823, -37.71561],
        [145.13965, -37.71644],
        [145.14061, -37.71671],
        [145.14166, -37.71674],
        [145.14269, -37.71656],
        [145.14458, -37.71613],
        [145.14546, -37.7159],
        [145.14626, -37.71547],
        [145.14681, -37.71481],
        [145.14819, -37.71257],
        [145.14855, -37.71187],
        [145.1487, -37.71128],
        [145.14874, -37.7097],
        [145.14872, -37.7087],
        [145.14879, -37.70765],
        [145.14913, -37.70702],
        [145.1496, -37.70651],
        [145.15031, -37.70598],
        [145.15171, -37.7049],
        [145.15441, -37.70299],
        [145.15495, -37.70225],
        [145.15525, -37.70121],
        [145.15527, -37.70074],
        [145.15499, -37.69965],
        [145.15456, -37.69907],
        [145.15297, -37.69737],
        [145.15259, -37.69681],
        [145.15239, -37.69629],
        [145.15239, -37.69566],
        [145.15263, -37.69496],
        [145.15398, -37.69282],
        [145.156, -37.68922],
        [145.15632, -37.68844],
        [145.15634, -37.68751],
        [145.15628, -37.68656],
        [145.15613, -37.68576],
        [145.15585, -37.68532],
        [145.15533, -37.68481],
        [145.15387, -37.68349],
        [145.15276, -37.68253],
        [145.15205, -37.68148],
        [145.15173, -37.68067],
        [145.15155, -37.68004],
        [145.15164, -37.679],
        [145.15192, -37.67829],
        [145.15229, -37.67768],
        [145.1528, -37.6771],
        [145.15344, -37.67661],
        [145.15394, -37.67611],
        [145.15482, -37.67535],
        [145.15555, -37.67481],
        [145.15621, -37.67442],
        [145.15728, -37.67384],
        [145.15816, -37.6735],
        [145.15915, -37.67323],
        [145.1601, -37.67306],
        [145.16104, -37.67292],
        [145.16327, -37.67275],
        [145.16411, -37.6726],
        [145.16542, -37.67212],
        [145.16634, -37.67151],
        [145.16707, -37.67107],
        [145.16771, -37.67076],
        [145.16879, -37.67041],
        [145.16992, -37.67007],
        [145.17089, -37.66983],
        [145.17278, -37.66925],
        [145.17422, -37.66881],
        [145.17565, -37.66834],
        [145.17808, -37.66766],
        [145.179, -37.6672],
        [145.1796, -37.66679],
        [145.18046, -37.66635],
        [145.18082, -37.66601],
        [145.18145, -37.66472],
        [145.18168, -37.66397],
        [145.18228, -37.66226],
        [145.18252, -37.66151],
        [145.18276, -37.66091],
        [145.18306, -37.66032],
        [145.1837, -37.65976],
        [145.18458, -37.65927],
        [145.18527, -37.65877],
        [145.1858, -37.65825],
        [145.18653, -37.65724],
        [145.18718, -37.65599],
        [145.18853, -37.65295],
        [145.18902, -37.65137],
        [145.18928, -37.65043],
        [145.18909, -37.6497],
        [145.18911, -37.64882],
        [145.18941, -37.64817],
        [145.18945, -37.64748],
        [145.18936, -37.64674],
        [145.18934, -37.64608],
        [145.18949, -37.64537],
        [145.1902, -37.6443],
        [145.19048, -37.64358],
        [145.19048, -37.64297],
        [145.19035, -37.64224],
        [145.19037, -37.64151],
        [145.19057, -37.64088],
        [145.19112, -37.6402],
        [145.19155, -37.63978]
      ]
    }, {
      "properties": {
        "Name": "Alamein Line",
        "name": "Alamein Line",
        "Id": "OjtDTgF5"
      },
      "paths": [
        [145.0589, -37.82665],
        [145.05994, -37.82661],
        [145.06329, -37.82643],
        [145.06519, -37.82637],
        [145.06686, -37.82613],
        [145.06744, -37.82608],
        [145.06776, -37.82611],
        [145.06829, -37.82622],
        [145.0688, -37.82642],
        [145.06905, -37.82656],
        [145.06935, -37.82676],
        [145.06964, -37.82706],
        [145.06981, -37.82732],
        [145.06994, -37.82758],
        [145.07003, -37.82785],
        [145.07008, -37.8282],
        [145.07007, -37.82855],
        [145.06989, -37.82974],
        [145.06974, -37.83092],
        [145.06964, -37.83147],
        [145.06931, -37.83348],
        [145.06935, -37.83388],
        [145.06946, -37.83422],
        [145.06958, -37.83453],
        [145.06973, -37.83481],
        [145.07539, -37.84374],
        [145.08057, -37.85157],
        [145.08167, -37.85337],
        [145.08246, -37.85463],
        [145.08276, -37.85522],
        [145.08297, -37.85583],
        [145.08308, -37.85648],
        [145.08311, -37.85738],
        [145.08302, -37.85788],
        [145.08286, -37.85834],
        [145.08207, -37.86018],
        [145.08098, -37.86288],
        [145.08035, -37.86435],
        [145.07967, -37.86832]
      ]
    }]

    function onListenerSelected(event) {
      console.log(event);
      const train = event.originEvent.target;
      const trainLocation = train.getLatLng();
      const layers = map.networkMaps.getLayers();

      const layer10 = layers[30];
      layers.forEach((l, index) => {
        if (l.setStyle && index !== 30) {
          l.setStyle({
            opacity: 0
          })
        }
      });

      const paths = layer10.getLatLngs();
      const pathsLength = paths.length;
      const closest = paths.reduce((current, next, index) => {
        const distance = next.distanceTo(trainLocation);
        if (distance > current.distance) {
          return current;
        }
        return {
          distance: distance,
          path: next,
          index: index
        };
      }, {
        distance: Infinity,
        path: null,
        index: 0
      });
      const closest2 = paths[closest.index + 1] || trainLocation;
      const point1 = closest.path;
      const point2 = closest2;
      const direction = L.enouvo.Util.getDirectionPoints(map_, [trainLocation, point1]);
      console.log('direction', direction);
      const angle = L.enouvo.Util.computeSegmentHeading(direction[0], direction[1]);
      console.log('angle', angle);

    }
    var map = L.enouvo.enouvoTrainInit('map');
    var map_ = map._map;
    map.setView([-37.81224, 144.97412], 15);
    map.setNetworkMaps(collections);
    map.addListeners([{
      event: 'click',
      action: onListenerSelected
    }]);
    map.setNetworkTrains(collections);
  </script>

</body>

</html>