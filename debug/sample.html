<!DOCTYPE html>
<html>

<head>
  <meta charset=utf-8 />
  <title>Enouvo Map</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <!-- Load Leaflet -->
  <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="../dist/leaflet-trains.css" />
  <script src="../node_modules/leaflet/dist/leaflet-src.js"></script>

  <!-- Load Esri Leaflet from source-->
  <script src="../dist/leaflet-trains-debug.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      right: 0;
      left: 0;
    }

    #info-pane {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      padding: 1em;
      background: white;
    }
  </style>
</head>

<body>

  <div id="map"></div>
  <script src="data.js"></script>
  <script>
    function onListenerSelected(event) {
      // const train = event.originEvent.target;
      // const trainLocation = train.getLatLng();
      // const layers = map.networkMaps.getLayers();

      // const layer10 = layers[30];
      // layers.forEach((l, index) => {
      //   if (l.setStyle && index !== 30) {
      //     l.setStyle({
      //       opacity: 0
      //     })
      //   }
      // });

      // const paths = layer10.getLatLngs();
      // const pathsLength = paths.length;
      // const closest = paths.reduce((current, next, index) => {
      //   const distance = next.distanceTo(trainLocation);
      //   if (distance > current.distance) {
      //     return current;
      //   }
      //   return {
      //     distance: distance,
      //     path: next,
      //     index: index
      //   };
      // }, {
      //   distance: Infinity,
      //   path: null,
      //   index: 0
      // });

      // const closest2 = paths[closest.index + 1] || trainLocation;
      // const point1 = closest.path;
      // const point2 = closest2;
      // const direction = L.enouvo.Util.getDirectionPoints(map_, [trainLocation, point1]);
      // const angle = L.enouvo.Util.computeSegmentHeading(direction[0], direction[1]);
      // console.log('angle', angle);

    }
    var map = L.enouvo.enouvoTrainInit('map');
    var map_ = map._map;
    map.setView([-37.81224, 144.97412], 15);
    map.setNetworkMaps(collections);
    map.addListeners([{
      event: 'click',
      action: onListenerSelected
    }]);
    map.setNetworkStations(stationsCollection);
    map.setNetworkTrains(trainsCollection);
  </script>

</body>

</html>